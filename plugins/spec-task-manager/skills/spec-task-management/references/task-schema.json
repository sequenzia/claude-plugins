{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Spec Task Manager Task List",
  "description": "Schema for task lists generated from specification documents",
  "type": "object",
  "required": ["metadata", "tasks"],
  "properties": {
    "metadata": {
      "type": "object",
      "required": ["source_document", "generated_at", "version", "total_tasks", "completion_percentage"],
      "properties": {
        "source_document": {
          "type": "string",
          "description": "Path or name of the source specification document"
        },
        "generated_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO-8601 timestamp when task list was created"
        },
        "last_updated": {
          "type": "string",
          "format": "date-time",
          "description": "ISO-8601 timestamp of last modification"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Semantic version of the task list"
        },
        "total_tasks": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of tasks in the list"
        },
        "completion_percentage": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Percentage of tasks completed"
        }
      }
    },
    "tasks": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "title", "description", "status", "priority", "complexity", "dependencies", "testing", "source_requirements"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^TASK-\\d{3,}$",
            "description": "Unique task identifier (e.g., TASK-001)"
          },
          "title": {
            "type": "string",
            "maxLength": 100,
            "description": "Brief descriptive title"
          },
          "description": {
            "type": "string",
            "description": "Detailed description of what needs to be done"
          },
          "status": {
            "type": "string",
            "enum": ["not_started", "in_progress", "blocked", "complete", "obsolete"],
            "description": "Current task status"
          },
          "priority": {
            "type": "string",
            "enum": ["critical", "high", "medium", "low"],
            "description": "Task priority level"
          },
          "complexity": {
            "type": "string",
            "enum": ["XS", "S", "M", "L", "XL"],
            "description": "T-shirt size complexity estimate"
          },
          "dependencies": {
            "type": "object",
            "properties": {
              "hard": {
                "type": "array",
                "items": { "type": "string", "pattern": "^TASK-\\d{3,}$" },
                "description": "Tasks that MUST be complete before this task can start"
              },
              "soft": {
                "type": "array",
                "items": { "type": "string", "pattern": "^TASK-\\d{3,}$" },
                "description": "Tasks that benefit from being complete but are not blocking"
              }
            },
            "default": { "hard": [], "soft": [] }
          },
          "blocked_by": {
            "type": "array",
            "items": { "type": "string", "pattern": "^TASK-\\d{3,}$" },
            "description": "Tasks currently blocking this task (computed from hard dependencies)"
          },
          "blocks": {
            "type": "array",
            "items": { "type": "string", "pattern": "^TASK-\\d{3,}$" },
            "description": "Tasks that this task is blocking"
          },
          "testing": {
            "type": "object",
            "required": ["acceptance_criteria"],
            "properties": {
              "acceptance_criteria": {
                "type": "array",
                "items": { "type": "string" },
                "minItems": 1,
                "description": "Conditions that must be true when task is complete"
              },
              "test_scenarios": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Concrete test cases to verify implementation"
              },
              "edge_cases": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Boundary conditions and error scenarios to consider"
              }
            }
          },
          "source_requirements": {
            "type": "array",
            "items": { "type": "string" },
            "minItems": 1,
            "description": "References to specification sections this task addresses"
          },
          "notes": {
            "type": "string",
            "description": "Optional additional context or implementation notes"
          },
          "estimated_effort": {
            "type": "string",
            "description": "Optional time estimate (e.g., '2-4 hours', '1 day')"
          }
        }
      }
    },
    "dependency_graph": {
      "type": "object",
      "properties": {
        "nodes": {
          "type": "array",
          "items": { "type": "string", "pattern": "^TASK-\\d{3,}$" },
          "description": "All task IDs in the graph"
        },
        "edges": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["from", "to", "type"],
            "properties": {
              "from": { "type": "string", "pattern": "^TASK-\\d{3,}$" },
              "to": { "type": "string", "pattern": "^TASK-\\d{3,}$" },
              "type": { "type": "string", "enum": ["hard", "soft", "resource"] }
            }
          },
          "description": "Dependency relationships between tasks"
        }
      }
    },
    "execution_phases": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["phase", "name", "tasks"],
        "properties": {
          "phase": {
            "type": "integer",
            "minimum": 1,
            "description": "Phase number for execution ordering"
          },
          "name": {
            "type": "string",
            "description": "Descriptive name for this phase"
          },
          "tasks": {
            "type": "array",
            "items": { "type": "string", "pattern": "^TASK-\\d{3,}$" },
            "description": "Tasks that can be executed in this phase"
          },
          "description": {
            "type": "string",
            "description": "Explanation of what this phase accomplishes"
          }
        }
      }
    }
  }
}
